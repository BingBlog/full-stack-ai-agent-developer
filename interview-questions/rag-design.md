# Prompt 设计与 RAG 架构

## 检索与数据准备

1. [频率:高][难度:易] 描述 RAG 的基本流程图以及检索层和生成层之间的桥接方式。 提示：强调 Query→ 检索 → 重排 → 拼接 → 生成。
2. [频率:高][难度:易] 原始文档清洗时需关注哪些结构信息以便后续分块？ 提示：参考标题层级、表格、代码块保留。
3. [频率:高][难度:中] 设计 chunk 策略时如何决定窗口大小与重叠率？ 提示：讨论语义完整性与向量数量。
4. [频率:高][难度:中] 面对多语言数据，如何处理编码、分词与翻译以保证检索效果？ 提示：比较多语模型、统一向量空间。
5. [频率:中][难度:中] 非结构化和结构化数据混合时，如何构建统一的检索入口？ 提示：考虑元数据、schema 映射。
6. [频率:中][难度:难] 对于实时更新的数据源，你会如何设计数据接入与刷新机制？ 提示：提到 CDC、消息队列、定时任务。
7. [频率:中][难度:难] 怎样在导入阶段做去重与质量评估，避免垃圾文档污染检索？ 提示：引用 hashing、相似度阈值、人工抽检。

## 向量化与索引

1. [频率:高][难度:易] Embedding 模型的选择依据是什么？如何在精度与性能之间权衡？ 提示：区分开源/闭源、维度大小。
2. [频率:高][难度:易] 如何评估向量化质量？常用的离线指标有哪些？ 提示：提及 Recall@K、NDCG、平均距离。
3. [频率:高][难度:中] Faiss IVF+PQ、HNSW、IVF-HNSW 的适用场景分别是什么？ 提示：考虑数据规模和延迟。
4. [频率:高][难度:中] Milvus、Weaviate、pgvector 在部署和扩展性上的差异是什么？ 提示：比较云原生、多副本、SQL 集成。
5. [频率:中][难度:中] 向量索引如何设计分区（Partition）与标签过滤以提升检索精准度？ 提示：关注 metadata routing。
6. [频率:中][难度:难] 当数据维度较高或分布不均时，你会采用哪些降维或归一化策略？ 提示：提到 PCA、L2 norm、互信息。
7. [频率:中][难度:难] 如何实现索引的增量更新与滚动重建，避免影响线上查询？ 提示：谈双写、影子索引、分批切换。

## 混合检索与排序

1. [频率:高][难度:中] Hybrid Search 的主要组合方式有哪些？它解决了哪些问题？ 提示：BM25+向量、粗排+精排。
2. [频率:中][难度:中] 当结构化过滤条件较多时，如何让混合检索保持低延迟？ 提示：考虑先过滤再向量召回。
3. [频率:中][难度:难] 什么是 Cross-Encoder 重排序，它与 Bi-Encoder 有何互补？ 提示：强调二阶段检索。
4. [频率:中][难度:难] 如何利用学习排序（Learning to Rank）提升最终生成质量？ 提示：说明特征设计与训练数据。
5. [频率:低][难度:难] 在多文档融合时，如何根据信心度或分数决定上下文拼接顺序？ 提示：探讨分数归一化。
6. [频率:低][难度:难] 当同一问题需要调用多个检索器时，如何进行结果合并与冲突解决？ 提示：考虑投票、加权、去重。
7. [频率:低][难度:难] 在 Agent 场景中如何动态选择检索策略，实现多工具协同？ 提示：结合策略路由与反馈环。

## 上下文构建与提示

1. [频率:高][难度:易] Context Window 限制下，如何选择重要片段进入提示？ 提示：使用压缩、召回评分、摘要。
2. [频率:中][难度:易] 解释 Context Compression 的常见做法，并分析对延迟的影响。 提示：文本摘要、关键词提取、向量重构。
3. [频率:中][难度:中] 如何设计系统提示和用户提示，使模型充分利用检索结果？ 提示：强调引用格式、出处标记。
4. [频率:中][难度:中] 对于结构化结果（表格、代码），怎样渲染到 prompt 中提升可读性？ 提示：考虑 Markdown、JSON、分块。
5. [频率:低][难度:中] 使用多轮对话时，如何保留历史检索信息避免上下文丢失？ 提示：讨论会话记忆与缓存。
6. [频率:低][难度:难] 在多查询重写（Query Rewriting）策略中，如何评估扩展查询的价值？ 提示：关注召回差异与噪声。
7. [频率:低][难度:难] 当模型需要引用多个来源时，如何设计引用追踪与可解释输出？ 提示：编号、链接、置信度说明。

## 安全与权限控制

1. [频率:高][难度:易] Prompt 注入在 RAG 场景中常见形式有哪些？如何建立输入净化流程？ 提示：黑名单、模式匹配、LLM 审查。
2. [频率:中][难度:易] 检索层如何结合权限体系，只返回用户可见的数据？ 提示：ACL、属性过滤、多索引隔离。
3. [频率:中][难度:中] 在多方协作或供应商接入时，如何审计检索请求与返回内容？ 提示：日志结构、签名、追踪 ID。
4. [频率:中][难度:中] 如何防止敏感数据在生成阶段被模型意外泄露？ 提示：输出过滤、关键字检测、风险评分。
5. [频率:低][难度:中] 当使用第三方向量库时，如何保证数据加密与传输安全？ 提示：TLS、KMS、字段级加密。
6. [频率:低][难度:难] 为何需要设置调用速率与成本限制？你会怎么设计策略？ 提示：基于租户、API Key、业务类别。
7. [频率:低][难度:难] 遇到合规审计时，需要准备哪些文档和指标说明 RAG 系统安全？ 提示：流程图、访问日志、白名单。

## 评估与优化

1. [频率:高][难度:易] 如何建立离线评估集衡量召回与相关性？ 提示：标注问答对、遮挡测试、负样本。
2. [频率:中][难度:易] 在线评估中，A/B 测试的设计要点有哪些？ 提示：控制变量、实验周期、显著性。
3. [频率:中][难度:中] 用户反馈（如重新搜索、点赞）如何转化为检索质量信号？ 提示：日志回放、反馈加权。
4. [频率:中][难度:中] 当模型生成存在幻觉时，你会从检索角度采取哪些补救措施？ 提示：增强召回、加强引用、重复确认。
5. [频率:低][难度:中] 如何监测索引漂移或 embedding 失效？ 提示：定期统计分布、评估召回率、报警阈值。
6. [频率:低][难度:难] 描述你在性能优化中使用缓存、批量查询或向量并行的经验。 提示：分层缓存、批处理、GPU 加速。
7. [频率:低][难度:难] 为减少成本，可采取哪些策略降低检索与生成的调用量？ 提示：智能复用、摘要前置、使用小模型。

## 项目实战与案例

1. [频率:高][难度:中] 分享一个你从零搭建的企业知识库 RAG 项目，最大的挑战是什么？ 提示：数据异构、权限复杂。
2. [频率:中][难度:中] 讲述一次你优化召回率的经历，具体采取了哪些手段？ 提示：模型升级、重排序、提示改写。
3. [频率:中][难度:难] 当业务方要求引用准确可追溯，你是如何验证和展示出处的？ 提示：引用标记、原文链接。
4. [频率:中][难度:难] 描述一次处理大规模数据更新的过程，如何确保检索不中断？ 提示：双索引、版本切换、灰度。
5. [频率:中][难度:难] 项目上线后，如何设置监控指标以快速定位问题？ 提示：检索延迟、命中率、用户满意度。
6. [频率:低][难度:难] 遇到多部门协同的场景，你如何定义接口与责任边界？ 提示：明确数据负责人、SLA、沟通机制。
7. [频率:低][难度:难] 当模型供应商更新版本时，你如何验证对检索链路的影响？ 提示：回归测试、对照实验。
8. [频率:低][难度:难] 结合真实案例，说明如何衡量 RAG 为业务带来的价值。 提示：节省人工审阅、提升解答准确率、减少响应时间。
